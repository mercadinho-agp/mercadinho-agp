<% content_for :head do %>
    <style>
        td div {
            display: flex;
            justify-content: flex-end;
        }
        .row .float-right{
            float: right;
        }
        .font-weight-bold {
            font-weight: 700!important;
        }
    </style>
    <script>
        function calculaTotal() {
            inputs = document.querySelectorAll('input[type=number]');
            total = 0;
            Array.prototype.forEach.call (inputs, function (input) {
                if (input.attributes.price) {
                   total += input.attributes.price.value * input.value;
                } 
            } );
            valorTotal = document.getElementById('valor-total')
            valorTotal.innerText = total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
    </script>
<% end %>

<h2>Produtos disponiveis</h2>
<div class="row">
    <div class="col-md-2 float-right">
      <%= button_to "< Cancelar", root_url, class: "btn btn-primary", form: { "method" => "get" } %>
    </div>
</div>
<br>

<%= form_for( Pedido.new ) do |form| %>
    <table class="table table-hover">
        <thead>
            <tr>
            <th scope="col">Produto</th>
            <th scope="col">Descricao</th>
            <th scope="col">Pre√ßo Unitario</th>
            <th scope="col">Qnt em estoque</th>
            <th scope="col" width="115">Quantidade</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Sabonete</td>
                <td>Frangancia de coco da praia</td>
                <td>2.89</td>
                <td>100</td>
                <td>
                    <input type="number" name="<%= "id"%>" class="form-control" step="1" price="2.89" onchange="calculaTotal()">
                </td>
            </tr>
            <tr>
                <td>Arroz</td>
                <td>Tipo 1, 5kg</td>
                <td>11.99</td>
                <td>50</td>
                <td>
                    <input type="number" name="<%= "id"%>" class="form-control" step="1">
                </td>
            </tr>
            <tr>
                <td colspan="2">Refigerante</td>
                <td>8.99</td>
                <td>10</td>
                <td>
                    <input type="number" name="<%= "id"%>" class="form-control" step="1">
                </td>
            </tr>
        </tbody>
    </table>
    
    <div class="row">
        <div class="col-md-2 float-right">
            <p class="font-weight-bold">Total R$ <span id="valor-total">0,00</span></p>
        </div>
    </div>

    <%= form.submit "Fechar pedido", class: "btn btn-primary mb-2 font-weight-bold" %>
<% end %>